# Portal S - Tuna Tunnels

–î–µ–º–æ-–ø–æ—Ä—Ç–∞–ª —Å —Ç—É–Ω–Ω–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ Tuna –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ —Å TUNA —Ç—É–Ω–Ω–µ–ª—è–º–∏

```bash
npm run tuna:domain
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

- Frontend: `https://surius.ru.tuna.am`
- API: `https://api-surius.ru.tuna.am`

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ client/                 # React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ (Vite)
‚îú‚îÄ‚îÄ server/                 # Node.js –±—ç–∫–µ–Ω–¥ (Express)
‚îú‚îÄ‚îÄ start-with-custom-domain.sh  # –°–∫—Ä–∏–ø—Ç –¥–ª—è TUNA —Ç—É–Ω–Ω–µ–ª–µ–π
‚îî‚îÄ‚îÄ .env                    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ tuna**: https://tuna.yuccastream.com/
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–æ–∫–µ–Ω** –≤ `.env`:
   ```
   TUNA_TOKEN=your_token_here
   ```
3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**:
   ```bash
   npm run install:all
   ```

## üåê –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- `npm run tuna:domain` - –ó–∞–ø—É—Å–∫ —Å TUNA —Ç—É–Ω–Ω–µ–ª—è–º–∏
- `npm run tuna:status` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—É–Ω–Ω–µ–ª–µ–π
- `npm run dev` - –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- `npm run build` - –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Vite (Frontend)

–ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç—É–Ω–Ω–µ–ª—è–º–∏:

- `host: '0.0.0.0'` - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- `allowedHosts: ['.ru.tuna.am', 'all']` - –†–∞–∑—Ä–µ—à–∞–µ—Ç tuna –¥–æ–º–µ–Ω—ã
- –ü—Ä–æ–∫—Å–∏ –¥–ª—è API: `/api` ‚Üí `http://localhost:3000`

### Express (Backend)

- –ü–æ—Ä—Ç: 3000
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
- MongoDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí https://surius.ru.tuna.am ‚Üí Tuna Tunnel ‚Üí Vite (5173) ‚Üí Backend (3000)
–í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã ‚Üí https://api-surius.ru.tuna.am ‚Üí Tuna Tunnel ‚Üí Backend (3000)
```

- **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: `https://surius.ru.tuna.am` (—á–µ—Ä–µ–∑ Tuna —Ç—É–Ω–Ω–µ–ª—å)
- **API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞**: –ü—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ Vite –Ω–∞ `localhost:3000`
- **API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º**: `https://api-surius.ru.tuna.am` (–æ—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω)
- **Backend**: `localhost:3000` (–ª–æ–∫–∞–ª—å–Ω–æ)

## üîå –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### Webhook endpoints

- `POST https://api-surius.ru.tuna.am/api/webhooks` - –û–±—â–∏–π webhook
- `POST https://api-surius.ru.tuna.am/api/webhooks/:system` - Webhook –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –¢–µ—Å—Ç webhook
curl -X POST https://api-surius.ru.tuna.am/api/webhooks \
  -H "Content-Type: application/json" \
  -d '{"type": "user.created", "data": {"id": 123, "name": "John"}}'

# Webhook –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
curl -X POST https://api-surius.ru.tuna.am/api/webhooks/stripe \
  -H "Content-Type: application/json" \
  -d '{"event": "payment.completed", "amount": 1000}'

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ npm
npm run test:webhook
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –¢—É–Ω–Ω–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞ –∑–∞–ø—É—â–µ–Ω —Å–∫—Ä–∏–ø—Ç
- –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ `Ctrl+C`
- Backend API –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞: `/api/*`
- –í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –º–æ–≥—É—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ API: `https://api.surius.ru.tuna.am`
- –í—Å–µ —Ç—É–Ω–Ω–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç HTTPS —Å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
