# Portal S - DevOps Guide

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã Portal S

### üìã –û–±—â–∏–π –æ–±–∑–æ—Ä

Portal S - —ç—Ç–æ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –ø–æ—Ä—Ç–∞–ª, —Å–æ—Å—Ç–æ—è—â–∏–π –∏–∑ React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏ Node.js –±—ç–∫–µ–Ω–¥–∞, –¥–æ—Å—Ç—É–ø–Ω—ã–π —á–µ—Ä–µ–∑ –ø—É–±–ª–∏—á–Ω—ã–µ —Ç—É–Ω–Ω–µ–ª–∏ TUNA.

### üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

#### 1. **Frontend (React + Vite)**

- **–ü–æ—Ä—Ç**: 5173
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: React 18, Material-UI, React Router
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: Vite —Å –æ—Ç–∫–ª—é—á–µ–Ω–Ω—ã–º HMR –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å —Ç—É–Ω–Ω–µ–ª–µ–º
- **–•–æ—Å—Ç**: `0.0.0.0` (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)

#### 2. **Backend (Node.js + Express)**

- **–ü–æ—Ä—Ç**: 3000
- **–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏**: Express, MongoDB
- **API**: RESTful endpoints —Å CORS –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: MongoDB —Å fallback –Ω–∞ mock –¥–∞–Ω–Ω—ã–µ

#### 3. **–¢—É–Ω–Ω–µ–ª–∏ TUNA**

- **Frontend —Ç—É–Ω–Ω–µ–ª—å**: `https://surius.ru.tuna.am` ‚Üí `localhost:5173`
- **API —Ç—É–Ω–Ω–µ–ª—å**: `https://api-surius.ru.tuna.am` ‚Üí `localhost:3000`

### üåê –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí https://surius.ru.tuna.am ‚Üí TUNA Tunnel ‚Üí Vite Dev Server (5173) ‚Üí Backend API (3000)
–í–Ω–µ—à–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã ‚Üí https://api-surius.ru.tuna.am ‚Üí TUNA Tunnel ‚Üí Backend API (3000)
```

### üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/Users/shoxy/s-project/
‚îú‚îÄ‚îÄ client/                    # React —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/       # UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/           # –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/           # React —Ö—É–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ store/           # –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mock/            # Mock –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Vite
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ server/                   # Node.js –±—ç–∫–µ–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/          # API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.js         # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ start-with-custom-domain.sh  # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ —Å —Ç—É–Ω–Ω–µ–ª—è–º–∏
‚îú‚îÄ‚îÄ .env                     # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ docker-compose.yml       # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∑–∞–ø—É—Å–∫)
```

## üöÄ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞

### –ß–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª–∏ (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±):

```bash
./start-with-custom-domain.sh
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ 3000, 5173, 4040, 4041
2. –ó–∞–ø—É—Å–∫ backend —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 3000
3. –ó–∞–ø—É—Å–∫ frontend —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É 5173
4. –°–æ–∑–¥–∞–Ω–∏–µ —Ç—É–Ω–Ω–µ–ª–µ–π TUNA:
   - Frontend: `surius.ru.tuna.am` ‚Üí `localhost:5173`
   - API: `api-surius.ru.tuna.am` ‚Üí `localhost:3000`

### –ß–µ—Ä–µ–∑ Docker (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±):

```bash
docker compose up -d
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Vite (Frontend)

```javascript
server: {
  port: 5173,
  host: '0.0.0.0',           // –í–Ω–µ—à–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  hmr: false,                 // –û—Ç–∫–ª—é—á–µ–Ω –¥–ª—è —Ç—É–Ω–Ω–µ–ª—è
  allowedHosts: ['.ru.tuna.am', 'all'],
  proxy: {
    '/api': {
      target: 'http://localhost:3000',
      changeOrigin: true
    }
  }
}
```

### Express (Backend)

```javascript
// CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –≤—Å–µ—Ö –¥–æ–º–µ–Ω–æ–≤
app.use(
  cors({
    origin: ["https://surius.ru.tuna.am", "https://api-surius.ru.tuna.am"],
    credentials: true,
  })
);
```

## üîå API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ:

- `GET /api/health` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- `GET /api/users` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `POST /api/webhooks` - Webhook endpoint

### –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª–∏:

- **Frontend**: `https://surius.ru.tuna.am/api/*`
- **–ü—Ä—è–º–æ–π API**: `https://api-surius.ru.tuna.am/api/*`

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### –õ–æ–≥–∏ —Ç—É–Ω–Ω–µ–ª–µ–π:

```
INFO[09:36:02] GET / ‚Äì 200 OK
INFO[09:36:02] GET /src/main.jsx ‚Äì 200 OK
INFO[09:36:03] GET /api/health ‚Äì 200 OK
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤:

- Backend: `http://localhost:3000/api/health`
- Frontend: `http://localhost:5173`
- TUNA Web Interface: `http://127.0.0.1:4040`

## üõ†Ô∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# .env
TUNA_TOKEN=tt_x5q44rjthm9voo8gdgbvsxf8rtyigzqn
PORT=3000
NODE_ENV=production
MONGO_ROOT_USERNAME=admin
MONGO_ROOT_PASSWORD=password123
CLIENT_URL=https://surius.ru.tuna.am
API_URL=https://api-surius.ru.tuna.am
```

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å—ã –∏ –ø–æ—Ä—Ç—ã

### –ê–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:

```bash
node src/index.js              # Backend (PID: 47793)
node vite                      # Frontend (PID: 47822)
tuna http 3000 --domain=api-surius.ru.tuna.am  # API —Ç—É–Ω–Ω–µ–ª—å
tuna http 5173 --domain=surius.ru.tuna.am       # Frontend —Ç—É–Ω–Ω–µ–ª—å
```

### –ü–æ—Ä—Ç—ã:

- **3000**: Backend API
- **5173**: Frontend Dev Server
- **4040/4041**: TUNA Web Interface

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ë–µ–ª—ã–π —ç–∫—Ä–∞–Ω:

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ç—É–Ω–Ω–µ–ª–µ–π
- –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à Vite: `rm -rf node_modules/.vite`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

### WebSocket –æ—à–∏–±–∫–∏:

- HMR –æ—Ç–∫–ª—é—á–µ–Ω –≤ `vite.config.js`
- –¢—É–Ω–Ω–µ–ª–∏ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç WebSocket

### Material-UI –æ—à–∏–±–∫–∏:

- –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `npm install`
- –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

- Vite –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- –û—Ç–∫–ª—é—á–µ–Ω HMR –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–∫—Å–∏ API —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
- Mock –¥–∞–Ω–Ω—ã–µ –¥–ª—è fallback

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

- –õ–æ–≥–∏ TUNA –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- Health checks –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –°—Ç–∞—Ç—É—Å —Ç—É–Ω–Ω–µ–ª–µ–π —á–µ—Ä–µ–∑ Web Interface

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- HTTPS —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª–∏ TUNA
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
- –¢–æ–∫–µ–Ω TUNA –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- MongoDB —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–µ–≤–æ–ø—Å–∞

### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã:

```bash
cd /Users/shoxy/s-project
./start-with-custom-domain.sh
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã:

```bash
# –ù–∞–∂–∞—Ç—å Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∏–ª–∏:
pkill -f "tuna.*http"
pkill -f "node.*src/index"
pkill -f vite
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep -E "(tuna|node.*src/index|vite)" | grep -v grep

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã
lsof -i :3000
lsof -i :5173

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
curl https://surius.ru.tuna.am
curl https://api-surius.ru.tuna.am/api/health
```

### –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
pkill -f "tuna.*http" && pkill -f "node.*src/index" && pkill -f vite

# –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
cd client && rm -rf node_modules/.vite && rm -rf dist

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
cd .. && ./start-with-custom-domain.sh
```

### Docker –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:

```bash
# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
docker compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker
docker compose down

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
docker compose build --no-cache
```

## üìù –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
# –õ–æ–≥–∏ —Ç—É–Ω–Ω–µ–ª–µ–π (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –∑–∞–ø—É—Å–∫–∞)
# –õ–æ–≥–∏ backend
tail -f server/logs/app.log

# –õ–æ–≥–∏ frontend (–≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Vite)
```

### –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –ø–æ—Ä—Ç–æ–≤
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Ç—É–Ω–Ω–µ–ª–µ–π
4. –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

```bash
# Frontend
cd client && npm update

# Backend
cd server && npm update

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
cd .. && ./start-with-custom-domain.sh
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TUNA:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é
tuna version

# –û–±–Ω–æ–≤–∏—Ç—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º –∏–∑ –ª–æ–≥–æ–≤
```

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —á–µ—Ä–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —Ç—É–Ω–Ω–µ–ª–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º SSL –∏ –¥–æ–º–µ–Ω–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –±–ª–∞–≥–æ–¥–∞—Ä—è –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ Vite.
