#!/bin/bash

echo "üöÄ –ó–∞–ø—É—Å–∫ Portal S Development Server"
echo "======================================"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤..."
pkill -f "vite|nodemon|concurrently" 2>/dev/null || true
sleep 2

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
if pgrep -f "vite|nodemon" > /dev/null; then
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:"
    echo "   sudo pkill -f 'vite|nodemon'"
    exit 1
fi

echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞..."
rm -rf client/node_modules/.vite
rm -rf client/dist
rm -rf server/dist

echo "‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤..."
if lsof -ti:5173 > /dev/null; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 5173 –∑–∞–Ω—è—Ç. –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º..."
    lsof -ti:5173 | xargs kill -9 2>/dev/null || true
fi

if lsof -ti:3000 > /dev/null; then
    echo "‚ö†Ô∏è  –ü–æ—Ä—Ç 3000 –∑–∞–Ω—è—Ç. –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º..."
    lsof -ti:3000 | xargs kill -9 2>/dev/null || true
fi

echo "‚úÖ –ü–æ—Ä—Ç—ã —Å–≤–æ–±–æ–¥–Ω—ã"

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞..."
npm run dev &

# –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞
echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤..."
sleep 5

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
echo "üìä –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–æ–≤:"
echo "Client (Vite): http://localhost:5173"
echo "Server (Node): http://localhost:3000"
echo ""
echo "üîß –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –≥–æ—Ä—è—á–µ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12)"
echo "2. Network ‚Üí Disable cache"
echo "3. Application ‚Üí Storage ‚Üí Clear storage"
echo ""
echo "üìù –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –≤—ã—à–µ. –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
