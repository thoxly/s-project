# Portal S - ELMA365 Integration Demo

–î–µ–º–æ-–ø–æ—Ä—Ç–∞–ª –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ "–°", –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ELMA365 + React/Node –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm run install:all

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞ (–¥–æ–±–∞–≤—å—Ç–µ TUNA_TOKEN)
# 3. –ó–∞–ø—É—Å–∫ —Å –≤–∞—à–∏–º –¥–æ–º–µ–Ω–æ–º
npm run tuna:domain
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

- Frontend: `https://surius.ru.tuna.am`
- API: `https://api-surius.ru.tuna.am`

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **Frontend**: React 18 + Vite + MUI + React Router
- **Backend**: Node.js + Express + MongoDB
- **Integration**: REST API ELMA365
- **Tunnels**: Tuna –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **API –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º**: –û—Ç–¥–µ–ª—å–Ω—ã–π –¥–æ–º–µ–Ω –¥–ª—è webhook'–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
portal-s/
‚îú‚îÄ‚îÄ client/          # React frontend
‚îú‚îÄ‚îÄ server/          # Express backend
‚îú‚îÄ‚îÄ docs/            # Documentation
‚îú‚îÄ‚îÄ start-with-custom-domain.sh     # –°–∫—Ä–∏–ø—Ç –¥–ª—è TUNA —Ç—É–Ω–Ω–µ–ª–µ–π
‚îú‚îÄ‚îÄ test-webhook.js                 # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook'–æ–≤
‚îî‚îÄ‚îÄ .env             # Environment variables
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
npm run install:all
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### MongoDB
```bash
# –ó–∞–ø—É—Å–∫ MongoDB (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω)
brew services start mongodb-community

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
mongosh --eval "db.runCommand('ping')"
```

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env`:

```bash
PORT=3000
MONGODB_URI=mongodb://localhost:27017/portal-s
ELMA_API_URL=https://your-elma-instance.elma365.com/api
ELMA_TOKEN=your-elma-token-here
TUNA_TOKEN=your-tuna-token-here
```

### 3. –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–∞ –∏ –±—ç–∫–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
npm run dev
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:5173

#### –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Tuna Tunnels

```bash
# –ó–∞–ø—É—Å–∫ —Å TUNA —Ç—É–Ω–Ω–µ–ª—è–º–∏
npm run tuna:domain
```

## üåç –ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ Tuna Tunnels

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Tuna –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—É–±–ª–∏—á–Ω—ã—Ö HTTPS-–¥–æ–º–µ–Ω–æ–≤.

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ó–∞–ø—É—Å–∫ —Å TUNA —Ç—É–Ω–Ω–µ–ª—è–º–∏
npm run tuna:domain
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**:

- Frontend: `https://surius.ru.tuna.am`
- API: `https://api-surius.ru.tuna.am`

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Ç—É–Ω–Ω–µ–ª–µ–π
npm run tuna:status

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ webhook'–æ–≤
npm run test:webhook

# –°–±–æ—Ä–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
npm run build
```

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **tuna**: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å https://tuna.yuccastream.com/
- **TUNA_TOKEN**: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ `.env` —Ñ–∞–π–ª–µ
- **–î–æ–º–µ–Ω—ã –≤ Tuna**: –°–æ–∑–¥–∞–π—Ç–µ –≤ –∞–¥–º–∏–Ω–∫–µ Tuna:
  - `surius.ru.tuna.am` (–¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞)
  - `api-surius.ru.tuna.am` (–¥–ª—è API)
- **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**: –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Tuna
- **–ü–æ—Ä—Ç—ã 3000, 5173**: –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–π –¥–æ–º–µ–Ω**: `surius.ru.tuna.am`
- ‚úÖ **HTTPS**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- ‚úÖ **–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è**: –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–∫–∞ –∑–∞–ø—É—â–µ–Ω —Å–∫—Ä–∏–ø—Ç
- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞

## üîå –í–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–æ–ª—É—á–µ–Ω–∏–µ webhook'–æ–≤ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º —á–µ—Ä–µ–∑ –æ—Ç–¥–µ–ª—å–Ω—ã–π API –¥–æ–º–µ–Ω.

### Webhook endpoints

- `POST https://api-surius.ru.tuna.am/api/webhooks` - –û–±—â–∏–π webhook
- `POST https://api-surius.ru.tuna.am/api/webhooks/:system` - Webhook –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –¢–µ—Å—Ç webhook
curl -X POST https://api-surius.ru.tuna.am/api/webhooks \
  -H "Content-Type: application/json" \
  -d '{"type": "user.created", "data": {"id": 123, "name": "John"}}'

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ npm
npm run test:webhook
```

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏

- **E1**: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ ‚úÖ
- **E2**: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (Dashboard)
- **E3**: –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
- **E4**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å ELMA365
- **E5**: –°–µ—Ä–≤–∏—Å –∑–∞—è–≤–æ–∫ (–∫–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥)
- **E6**: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **E7**: –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π
- **E8**: UI-–ø–æ–ª–∏—Ä–æ–≤–∫–∞ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç
- **E9**: –î–µ–ø–ª–æ–π –∏ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
- **E10**: ELMA365 ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–æ—Ü–µ—Å—Å "–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è / –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç—å –ü–û"?, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Node API

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- MongoDB 6+ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å mock —Ä–µ–∂–∏–º)
- npm –∏–ª–∏ yarn
- tuna (–¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [Tuna Tunnels](TUNA_README.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç—É–Ω–Ω–µ–ª—è–º
- [–°—Ç–∏–ª—å –∫–æ–¥–∞](docs/STYLE_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Å—Ç–∏–ª—é –∫–æ–¥–∞
- [–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞](docs/PROJECT_CONTEXT.md) - –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
